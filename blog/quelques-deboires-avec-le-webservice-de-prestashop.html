<!DOCTYPE html><html lang=fr><head><title>Quelques d√©boires avec le webservice de Prestashop</title><meta content="Blog de Bob Maerten ou y sont expos√©s en vrac, humeurs, interrogations, p√¢tisseries, d√©veloppement web, syst√®mes Linux et autres curiosit√©s." name=description /><meta content="width=device-width, initial-scale=1" name=viewport /><meta content="Bob Maerten" property="dc:creator"/><meta content="text/html" property="dc:format"/><meta content=fr-FR property="dc:language"/><meta content="Bob Maerten ‚Äî Blog Perso" property="og:site_name"/><meta content=website property="og:type"/><meta content="https://bobmaerten.eu" property="og:url"/><meta content="Quelques d√©boires avec le webservice de Prestashop" property="og:title"/><meta content="Humeurs, interrogations, p√¢tisseries, d√©veloppement web, syst√®mes Linux et autres curiosit√©s" property="og:description"/><meta content="https://bobmaerten.eu/img/avatar2014-89449806.jpg" property="og:image"/><meta content="50.348923;3.488592" name="geo.position"/><meta content="Valenciennes, Nord" name="geo.placename"/><meta content=FR-59 name="geo.region"/><meta content="@bobmaerten" name="twitter:site"/><meta content="Quelques d√©boires avec le webservice de Prestashop" name="twitter:title"/><meta content="Humeurs, interrogations, p√¢tisseries, d√©veloppement web, syst√®mes Linux et autres curiosit√©s" name="twitter:description"/><meta content=summary_large_image name="twitter:card"/><meta content="https://bobmaerten.eu/img/forestway-a1a17a16.jpg" name="twitter:image:src"/><meta content="@bobmaerten" name="twitter:creator"/><meta content="Quelques d√©boires avec le webservice de Prestashop" itemprop=name /><meta content="Humeurs, interrogations, p√¢tisseries, d√©veloppement web, syst√®mes Linux et autres curiosit√©s" itemprop=description /><meta content="https://bobmaerten.eu/img/avatar2014-89449806.jpg" itemprop=image /><link href="https://plus.google.com/+BobMaerten" rel=publisher /><link href="/atom.xml" rel=alternate title="Bob Maerten ‚Äî Blog Perso" type="application/rss+xml"/><meta content=yes name=mobile-web-app-capable /><meta content="Bob Maerten ‚Äî Blog Perso" name=application-name /><link href="/chrome-touch-icon-192x192.png" rel=icon sizes=192x192 /><meta content=yes name=apple-mobile-web-app-capable /><meta content=black name=apple-mobile-web-app-status-bar-style /><meta content="Bob Maerten ‚Äî Blog Perso" name=apple-mobile-web-app-title /><link href="/apple-touch-icon.png" rel=apple-touch-icon /><meta content="ms-touch-icon-144x144-precomposed.png" name=msapplication-TileImage /><meta content="#F5F5F5" name=msapplication-TileColor /><meta content="#F5F5F5" name=theme-color /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><link href="../css/main-8e11d2a2.css" rel=stylesheet /></head><body id=top><header id=header><a class="image avatar" href="/"><img srcset="../img/avatar2014_2x-09ee3761.jpg 2x" alt="Photo de Bob Maerten" src="../img/avatar2014-89449806.jpg"/></a><h1><strong>Bob Maerten</strong><br/> Humeurs, interrogations, p√¢tisseries, d√©veloppement web, syst√®mes Linux et autres curiosit√©s. </h1><ul class=nav><li><a href="../about.html">√Ä propos</a></li><li><a href="./">Blog</a></li></ul></header><div id=main><section id=post><header class=major><h2 class=post-title>Quelques d√©boires avec le webservice de Prestashop</h2></header><div class="image fit"><img srcset="../img/forestway_2x-1f2fe8f7.jpg 2x" alt=forestway src="../img/forestway-a1a17a16.jpg"/></div><p class=post-meta><span>17 Jun 2015</span><br/><span><a class="post-category post-category-dev" href="tags/dev.html">dev</a></span><span><a class="post-category post-category-work" href="tags/work.html">work</a></span></p><div class=post-description><p><p>Tiens il y avait un moment que je n&#39;avais pas √©crit par ici, et une fois n&#39;est pas coutume il s&#39;agit d&#39;un billet pour √©vacuer. C&#39;est Prestashop qui va en prendre pour son grade. Eh oui, Prestashop. Car m√™me si mon activit√© principale est d&#39;√©voluer avec Ruby on Rails, il arrive √† l&#39;occasion que l&#39;on doivent explorer d&#39;autres univers.</p> <p></p> <p>Dans le cadre du boulot nous devons actuellement interfacer un <em>backoffice</em> maison avec un <em>front-end</em> Prestashop. Pour cela, nous avons pris le parti d&#39;utiliser au maximum l&#39;API REST de l&#39;outil. Celle-ci est assez bien fichue car elle permet non seulement d&#39;acc√©der aux principaux √©l√©ments de la boutique (produits, commandes, clients, stocks, etc.) mais √©galement de les modifier. Et c&#39;est sur ces mises √† jour que s&#39;est d√©vers√© la rage que je tente d&#39;√©vacuer ici‚Ä¶</p> <p>J&#39;avais des erreurs 500 qui se d√©clenchaient lors de mes tentatives de mise √† jours via le webservice, mais rien d&#39;autre. Les retours des appels HTTP se contentaient de pr√©ciser d&#39;aller voir les logs, dans lesquels il n&#39;y avait bien √©videmment rien, malgr√© un param√©trage de PHP/Apache plut√¥t verbeux.</p> <p>Il faut savoir que les appels √† l&#39;API ne sont pas verbeux par d√©faut, et il m&#39;a fallu longuement chercher pour comprendre et forcer le syst√®me de verbosit√© du webservice de Prestashop. J&#39;ai clairement perdu les r√©flexes et les usages des applications PHP, et surtout travaillant avec Rails, on s&#39;habitue vite aux environnements bien isol√©s et proprement d√©clar√©s (merci <code>RAKE_ENV/RAILS_ENV</code>).</p> <p>Par convention les valeurs permettant de contr√¥ler le comportement de Prestashop sont √† modifier dans <code>config/settings.inc.php</code>. Or pour la verbosit√© des messages d&#39;erreurs du webservice, il faut forcer dans <code>config/defines.inc.php</code> la variable <code>_PS_MODE_DEV_</code> √† <strong>true</strong> par que dans celui dans lequel on s&#39;attend √† ce que √ßa fonctionne, eh bien, √ßa ne fonctionne pas. Et je passe sur le fait de devoir fonctionner en mode <code>DEV</code> pour avoir les messages d&#39;erreurs de l&#39;API. Eh donc √ßa veut dire qu&#39;en prod, tu dois tourner en mode dev aussi&nbsp;?!</p> <p>D&#39;autre part, la consigne dans les documentations du webservice stipulent bien que pour la modification d&#39;une ressource il faut d&#39;abord r√©cup√©rer le contenu XML via le webservice pour le renvoyer selon le m√™me format avec les modifications. Cela ne fonctionnait pas sur certaines ressources (stock, produits, etc.) mais par manque de verbosit√© des messages il √©tait d√©licat de comprendre pourquoi.</p> <p>Avec des messages plus ‚Äúclairs‚Äù sur la mise √† jour du stock comme : ‚ÄúVous ne pouvez pas mettre √† jour le stock disponible quand il d√©pend du stock‚Äù, ce n&#39;est pas forc√©ment beaucoup plus √©vident, mais en l&#39;occurrence l&#39;id√©e est ici de modifier non seulement la valeur de quantit√© mais √©galement la valeur de <code>depends_on_stock</code>. Je n&#39;aurais jamais trouv√© sans l&#39;affichage de ces messages d&#39;erreurs&nbsp;!</p> <p>D&#39;autres sont plus myst√©rieux dans la mesure ou il faut supprimer des lignes pour que la validation de la ressource s&#39;effectue correctement. Ce n&#39;est bien √©videmment pas pr√©cis√© dans la documentation, uniquement sur ces fichus messages d&#39;erreur. Pour la mise √† jour d&#39;un produit par exemple&nbsp;: ‚Äú<em>parameter <code>manufacturer_name</code> not writable. Please remove this attribute of this XML</em>‚Äù, signifie qu&#39;il faut supprimer le param√®tre sp√©cifi√© dans le XML pass√© (et <code>quantity</code> √©galement au passage, message qui n&#39;appara√Æt qu&#39;√† la tentative suivante‚Ä¶). Bref, tout cela va peut-√™tre sans dire pour les habitu√©s du <em>framework</em>, mais √ßa va tout de m√™me mieux en le disant.</p> <p>D√©j√† que j&#39;√©tais pas fan de XML, mais l√†, devoir le triturer pour pouvoir mettre √† jour des donn√©es, c&#39;√©tait le pompon. Heureusement qu&#39;il y a des <em>libs</em> qui font √ßa √† peu pr√®s bien, mais tout √ßa reste du XML et quelque part, pas franchement naturel √† utiliser.</p> <p>Allez, on va dire que c&#39;√©tait un mauvais moment √† passer. Jusqu&#39;√† la prochaine mise √† jour de l&#39;API‚Ä¶ üò¨</p> </p></div></section><section id=comments><h2>Commentaires</h2><div aria-live=polite id=juvia_thread><noscript>Please enable JavaScript to view the comments powered by Juvia.</noscript></div></section></div><footer id=footer><ul class=icons><li><a class="icon fa-envelope-o" href="#email-protection-uryyb@oboznregra.rh"><span class=label>Email</span></a></li><li><a class="icon fa-rss" href="/atom.xml"><span class=label>RSS</span></a></li><li><a class="icon fa-twitter" href="https://twitter.com/bobmaerten"><span class=label>Twitter</span></a></li><li><a class="icon fa-github" href="https://github.com/bobmaerten"><span class=label>Github</span></a></li></ul><ul class=copyright><li>¬© Bob Maerten</li><li>Design&nbsp;: <a href="http://html5up.net">HTML5 UP</a></li><li>Photo&nbsp;: <a href="http://unsplash.com/juskteez/">Juskteez Vu</a></li></ul></footer><script src="../js/all-39da47a7.js"></script><script src="../js/juvia-10e4cb99.js"></script><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>