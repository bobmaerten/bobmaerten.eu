<!DOCTYPE html><html lang=fr><head><title>Tester wallabag dans Docker</title><meta content="Blog de Bob Maerten ou y sont exposés en vrac, humeurs, interrogations, pâtisseries, développement web, systèmes Linux et autres curiosités." name=description /><meta content="width=device-width, initial-scale=1" name=viewport /><meta content="Bob Maerten" property="dc:creator"/><meta content="text/html" property="dc:format"/><meta content=fr-FR property="dc:language"/><meta content="Bob Maerten — Blog Perso" property="og:site_name"/><meta content=website property="og:type"/><meta content="https://bobmaerten.eu" property="og:url"/><meta content="Tester wallabag dans Docker" property="og:title"/><meta content="Humeurs, interrogations, pâtisseries, développement web, systèmes Linux et autres curiosités" property="og:description"/><meta content="https://bobmaerten.eu/img/avatar2014-89449806.jpg" property="og:image"/><meta content="50.348923;3.488592" name="geo.position"/><meta content="Valenciennes, Nord" name="geo.placename"/><meta content=FR-59 name="geo.region"/><meta content="@bobmaerten" name="twitter:site"/><meta content="Tester wallabag dans Docker" name="twitter:title"/><meta content="Humeurs, interrogations, pâtisseries, développement web, systèmes Linux et autres curiosités" name="twitter:description"/><meta content=summary_large_image name="twitter:card"/><meta content="https://bobmaerten.eu/img/city-573784cb.jpg" name="twitter:image:src"/><meta content="@bobmaerten" name="twitter:creator"/><meta content="Tester wallabag dans Docker" itemprop=name /><meta content="Humeurs, interrogations, pâtisseries, développement web, systèmes Linux et autres curiosités" itemprop=description /><meta content="https://bobmaerten.eu/img/avatar2014-89449806.jpg" itemprop=image /><link href="https://plus.google.com/+BobMaerten" rel=publisher /><link href="/atom.xml" rel=alternate title="Bob Maerten — Blog Perso" type="application/rss+xml"/><meta content=yes name=mobile-web-app-capable /><meta content="Bob Maerten — Blog Perso" name=application-name /><link href="/chrome-touch-icon-192x192.png" rel=icon sizes=192x192 /><meta content=yes name=apple-mobile-web-app-capable /><meta content=black name=apple-mobile-web-app-status-bar-style /><meta content="Bob Maerten — Blog Perso" name=apple-mobile-web-app-title /><link href="/apple-touch-icon.png" rel=apple-touch-icon /><meta content="ms-touch-icon-144x144-precomposed.png" name=msapplication-TileImage /><meta content="#F5F5F5" name=msapplication-TileColor /><meta content="#F5F5F5" name=theme-color /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><link href="../css/main-8e11d2a2.css" rel=stylesheet /></head><body id=top><header id=header><a class="image avatar" href="/"><img srcset="../img/avatar2014_2x-09ee3761.jpg 2x" alt="Photo de Bob Maerten" src="../img/avatar2014-89449806.jpg"/></a><h1><strong>Bob Maerten</strong><br/> Humeurs, interrogations, pâtisseries, développement web, systèmes Linux et autres curiosités. </h1><ul class=nav><li><a href="../about.html">À propos</a></li><li><a href="./">Blog</a></li></ul></header><div id=main><section id=post><header class=major><h2 class=post-title>Tester wallabag dans Docker</h2></header><div class="image fit"><img srcset="../img/city_2x-0e5d9215.jpg 2x" alt=city src="../img/city-573784cb.jpg"/></div><p class=post-meta><span>14 Fev 2014</span><br/><span><a class="post-category post-category-sysadm" href="tags/sysadm.html">sysadm</a></span></p><div class=post-description><p><p>TL;DR: <code>sudo docker pull bobmaerten/docker-wallabag &amp;&amp; sudo docker run -p 8080:80 -d bobmaerten/docker-wallabag</code> et hop, direct dans ton <em>browser</em> <a href="http://localhost:8080">http://localhost:8080</a></p> <p>Évidemment, cela fonctionne mieux si vous avez déjà installé Docker. Sinon, les explications sont assez claires sur la <a href="http://docs.docker.io/en/latest/">documentation exhaustive</a>. Il y a même depuis la version 0.8 un support officiel pour MacOs.</p> <p></p> <p><img alt="Docker image" src="https://www.docker.io/static/img/homepage-docker-logo.png"/></p> <p>Cela faisait quelques temps que je voulais m&#39;intéresser à <a href="http://docker.io">Docker</a> et à la construction d&#39;image. Dans le même temps, il y avait un <a href="https://github.com/wallabag/wallabag/issues/220">ticket ouvert</a> sur le projet <a href="http://wallabag.org">wallabag</a> pour disposer d&#39;une image Docker afin de tester la solution. C&#39;était donc l&#39;occasion de s&#39;y mettre et de contribuer à ma manière au projet.</p> <p>Le principe de docker réside en la superposition de différentes couches systèmes. En fusionnant ces différentes couches (la méthode diffère en fonction du <em>filesystem</em> utilisé), on obtient alors un système complet et potentiellement issu de plusieurs sources aggrégées. Cette souplesse, liée à l&#39;isolation du système fournit par LXC (LinuX Containers) permet de profiter de nombreuses choses regroupeés dans <a href="http://index.docker.io">l&#39;index docker</a>, un site communautaire qui permet de partager des images toutes prêtes que l&#39;on peut directement utiliser telles quelles, ou mieux, surcharger pour un autre usage.</p> <p>La création d&#39;une image docker repose sur l&#39;équivalent d&#39;un script qui sera exécuté. Dans ce fichier <code>Dockerfile</code>, on trouve un certain nombre de directive permettant de scripter une installation. Pour le sujet qui m&#39;intéresse, j&#39;avais besoin de faire tourner un script PHP derriere un serveur web. Je suis parti d&#39;une image assez bas niveau de ubuntu saucy fournie par docker, mais j&#39;aurais très bien pu parcourir l&#39;index et trouver une image correspondant à mon besoin pour l&#39;amender. Les directives sont au final assez explicites, <code>FROM</code> pour spécifier un point de départ, <code>RUN</code> pour exécuter des commandes, <code>ADD</code> pour déposer des fichiers stockés en dehors du container, etc.</p> <p>Voici le Dockerfile qui permet de déployer, configurer et lancer wallabag avec nginx et php-fpm :</p> <pre class="highlight plaintext"><code># Specify Ubuntu Saucy as base image
FROM ubuntu:saucy

MAINTAINER Bob Maerten &lt;bob.maerten@gmail.com&gt;

# Install latest nginx
RUN apt-get update
ENV DEBIAN_FRONTEND noninteractive
RUN apt-get install -y dialog net-tools lynx vim wget curl postfix
RUN apt-get install -y python-software-properties software-properties-common
RUN add-apt-repository ppa:nginx/stable
RUN apt-get update

# Install git nginx php-fpm and wallabag prereqs
RUN apt-get install -y nginx git php5-cli php5-common php5-sqlite php5-curl php5-fpm php5-json php5-tidy

# Configure php-fpm
RUN echo 'cgi.fix_pathinfo = 0;' &gt;&gt; /etc/php5/fpm/php.ini
RUN echo 'daemon off;' &gt;&gt; /etc/nginx/nginx.conf

# Installing git to fetch latest wallabag
RUN mkdir /var/www/wallabag || echo 'Sources directory already present'

# Clone wallabag code repository
RUN git clone https://github.com/wallabag/wallabag.git /var/www/wallabag

# Checkout latest tmux version
RUN cd /var/www/wallabag &amp;&amp; git checkout tags/1.5.0

# Install wallabag
RUN cd /var/www/wallabag; curl -sS https://getcomposer.org/installer | php; php composer.phar install
RUN cp /var/www/wallabag/inc/poche/config.inc.php.new /var/www/wallabag/inc/poche/config.inc.php
RUN sed -i 's/('SALT', '')/('SALT', 'absolutlynotsafesaltvalue')/' /var/www/wallabag/inc/poche/config.inc.php
RUN cp /var/www/wallabag/install/poche.sqlite /var/www/wallabag/db/
RUN chown -R www-data:www-data /var/www/wallabag
RUN chmod 755 -R /var/www/wallabag
RUN rm -rf /var/www/wallabag/install

# Configure nginx to serve wallabag app
ADD ./nginx-wallabag /etc/nginx/sites-available/default

EXPOSE 80

CMD service php5-fpm start &amp;&amp; nginx
</code></pre> <p>Sommes toutes, il s&#39;agit ni plus ni moins que de scripter l&#39;installation telle qu&#39;on la suivrait pour installer le logiciel.</p> <p>De la on peut démarrer le service (grâce aux directives <code>CMD</code> et <code>EXPOSE</code>) et profiter d&#39;un environnement wallabag fraichement installé pour tester, ou pour participer à son développement.</p> <p><img alt="wallabag image" src="http://www.wallabag.org/wp-content/uploads/2014/02/logo-typo-horizontal-no-bg-lg.png"/></p> <p><em>Happy hacking!</em></p> </p></div></section><section id=comments><h2>Commentaires</h2><div aria-live=polite id=juvia_thread><noscript>Please enable JavaScript to view the comments powered by Juvia.</noscript></div></section></div><footer id=footer><ul class=icons><li><a class="icon fa-envelope-o" href="#email-protection-uryyb@oboznregra.rh"><span class=label>Email</span></a></li><li><a class="icon fa-rss" href="/atom.xml"><span class=label>RSS</span></a></li><li><a class="icon fa-twitter" href="https://twitter.com/bobmaerten"><span class=label>Twitter</span></a></li><li><a class="icon fa-github" href="https://github.com/bobmaerten"><span class=label>Github</span></a></li></ul><ul class=copyright><li>© Bob Maerten</li><li>Design&nbsp;: <a href="http://html5up.net">HTML5 UP</a></li><li>Photo&nbsp;: <a href="http://unsplash.com/juskteez/">Juskteez Vu</a></li></ul></footer><script src="../js/all-39da47a7.js"></script><script src="../js/juvia-10e4cb99.js"></script><script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body></html>